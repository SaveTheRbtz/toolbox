# team activity batch user 

複数ユーザーのアクティビティを一括取得します 

# 利用方法

このドキュメントは"デスクトップ"フォルダを例として使用します.

## 実行

Windows:

```powershell
cd $HOME\Desktop
.\tbx.exe team activity batch user -file /path/to/file.csv
```

macOS, Linux:

```bash
$HOME/Desktop/tbx team activity batch user -file /path/to/file.csv
```

macOS Catalina 10.15以上の場合: macOSは開発者情報を検証します. 現在、`tbx`はそれに対応していません. 実行時の最初に表示されるダイアログではキャンセルします. 続いて、”システム環境設定"のセキュリティーとプライバシーから一般タブを選択します.
次のようなメッセージが表示されています:
> "tbx"は開発元を確認できないため、使用がブロックされました。

"このまま開く"というボタンがあります. リスクを確認の上、開いてください. ２回目の実行ではダイアログに"開く”ボタンがありますので、これを選択します

## オプション

| オプション    | 説明                                                                                  | デフォルト |
|---------------|---------------------------------------------------------------------------------------|------------|
| `-category`   | 一つのイベントカテゴリのみを返すようなフィルター条件. このフィールドはオプションです. |            |
| `-end-time`   | 終了日時 (該当同時刻を含まない).                                                      |            |
| `-file`       | メールアドレスリストのファイル                                                        |            |
| `-peer`       | アカウントの別名                                                                      | default    |
| `-start-time` | 開始日時 (該当時刻を含む)                                                             |            |

共通のオプション:

| オプション        | 説明                                                                                               | デフォルト     |
|-------------------|----------------------------------------------------------------------------------------------------|----------------|
| `-auto-open`      | 成果物フォルダまたはURLを自動で開く                                                                | false          |
| `-bandwidth-kb`   | コンテンツをアップロードまたはダウンロードする際の帯域幅制限(Kバイト毎秒). 0の場合、制限を行わない | 0              |
| `-budget-memory`  | メモリの割り当て目標 (メモリ使用量を減らすために幾つかの機能が制限されます)                        | normal         |
| `-budget-storage` | ストレージの利用目標 (ストレージ利用を減らすためログ、機能を限定します)                            | normal         |
| `-concurrency`    | 指定した並列度で並列処理を行います                                                                 | プロセッサー数 |
| `-debug`          | デバッグモードを有効にする                                                                         | false          |
| `-output`         | 出力書式 (none/text/markdown/json)                                                                 | text           |
| `-proxy`          | HTTP/HTTPS プロクシ (ホスト名:ポート番号)                                                          |                |
| `-quiet`          | エラー以外のメッセージを抑制し、出力をJSONLフォーマットに変更します                                | false          |
| `-secure`         | トークンをファイルに保存しません                                                                   | false          |
| `-workspace`      | ワークスペースへのパス                                                                             |                |

# ファイル書式

## 書式: File

メンバーのアクティビティを一括取得するためのデータファイル. 

| 列    | 説明                     | 値の例           |
|-------|--------------------------|------------------|
| email | ユーザーのメールアドレス | john@example.com |

最初の行はヘッダ行です. プログラムはヘッダ行がない場合も認識します.

```csv
email
john@example.com
```

# ネットワークプロクシの設定

プログラムはシステム設定から自動的にプロクシ設定情報を取得します. しかしながら、それでもエラーが発生する場合には明示的にプロクシを指定することができます. `-proxy` オプションを利用します, `-proxy ホスト名:ポート番号`のように指定してください. なお、現在のところ認証が必要なプロクシには対応していません.

# 実行結果

作成されたレポートファイルのパスはコマンド実行時の最後に表示されます. もしコマンドライン出力を失ってしまった場合には次のパスを確認してください. [job-id]は実行の日時となります. このなかの最新のjob-idを各委任してください.

| OS      | Path                                                                                                      |
| ------- | --------------------------------------------------------------------------------------------------------- |
| Windows | `%HOMEPATH%\.toolbox\jobs\[job-id]\reports` (e.g. C:\Users\bob\.toolbox\jobs\20190909-115959.597\reports) |
| macOS   | `$HOME/.toolbox/jobs/[job-id]/reports` (e.g. /Users/bob/.toolbox/jobs/20190909-115959.597/reports)        |
| Linux   | `$HOME/.toolbox/jobs/[job-id]/reports` (e.g. /home/bob/.toolbox/jobs/20190909-115959.597/reports)         |

## レポート: combined 
このレポートはDropbox Businessのアクティビティログとほぼ互換性のあるアクティビティレポートを出力します.
レポートファイルは次の3種類のフォーマットで出力されます;
* `combined.csv`
* `combined.xlsx`
* `combined.json`

`-budget-memory low`オプションを指定した場合、レポートはJSON形式のみで生成されます

レポートが大きなものとなる場合、`.xlsx`フォーマットのファイルは次のようにいくつかに分割されて出力されます;
`combined_0000.xlsx`, `combined_0001.xlsx`, `combined_0002.xlsx`...   

| 列                       | 説明                                                            |
|--------------------------|-----------------------------------------------------------------|
| timestamp                | このアクションが実行されたDropbox側でのタイムスタンプ.          |
| member                   | ユーザーの表示名                                                |
| member_email             | ユーザーのメールアドレス                                        |
| event_type               | 実行されたアクションのタイプ                                    |
| category                 | 監査ログイベントのカテゴリー                                    |
| access_method            | アクションが実行された方法.                                     |
| ip_address               | IPアドレス.                                                     |
| country                  | 国                                                              |
| city                     | 市町村                                                          |
| involve_non_team_members | 1名以上のチーム外のユーザーがこのアクションに関連した場合はTrue |
| participants             | このアクションによって影響を受けたユーザーまたはグループ        |
| context                  | アクターがアクションを実行したユーザーまたはチーム              |
| assets                   | アクションに関連したコンテンツ資産.                             |
| other_info               | このタイプのアクションに適用可能な可変イベントスキーマ.         |

## レポート: user 
このレポートはDropbox Businessのアクティビティログとほぼ互換性のあるアクティビティレポートを出力します.
レポートファイルは次の3種類のフォーマットで出力されます;
* `user.csv`
* `user.xlsx`
* `user.json`

`-budget-memory low`オプションを指定した場合、レポートはJSON形式のみで生成されます

レポートが大きなものとなる場合、`.xlsx`フォーマットのファイルは次のようにいくつかに分割されて出力されます;
`user_0000.xlsx`, `user_0001.xlsx`, `user_0002.xlsx`...   

| 列                       | 説明                                                            |
|--------------------------|-----------------------------------------------------------------|
| timestamp                | このアクションが実行されたDropbox側でのタイムスタンプ.          |
| member                   | ユーザーの表示名                                                |
| member_email             | ユーザーのメールアドレス                                        |
| event_type               | 実行されたアクションのタイプ                                    |
| category                 | 監査ログイベントのカテゴリー                                    |
| access_method            | アクションが実行された方法.                                     |
| ip_address               | IPアドレス.                                                     |
| country                  | 国                                                              |
| city                     | 市町村                                                          |
| involve_non_team_members | 1名以上のチーム外のユーザーがこのアクションに関連した場合はTrue |
| participants             | このアクションによって影響を受けたユーザーまたはグループ        |
| context                  | アクターがアクションを実行したユーザーまたはチーム              |
| assets                   | アクションに関連したコンテンツ資産.                             |
| other_info               | このタイプのアクションに適用可能な可変イベントスキーマ.         |

